<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Me ‚Äì Sistema de Avistamientos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- ‚ú® CSS MODULAR -->
    <link rel="stylesheet" href="css/header.css" />
    <link rel="stylesheet" href="css/navigation.css" />
    <link rel="stylesheet" href="css/modular.css" />
    <link rel="stylesheet" href="css/forms.css" />
    <link rel="stylesheet" href="css/login.css" />

    <!-- ‚ú® Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />
</head>
<body>

<!-- ============================================ -->
<!-- HEADER PROFESIONAL CON NAVEGACI√ìN -->
<!-- ============================================ -->
<header class="app-header">
    <!-- Logo / Brand -->
    <h1>Find Me</h1>

    <!-- Navegaci√≥n Principal -->
    <nav class="nav">
        <button class="nav__button" id="btnNavAvistador">Registrarme</button>
        <button class="nav__button" id="btnNavForm">Registrar desaparecido</button>
        <button class="nav__button" id="btnNavList">Ver lista</button>
        <button class="nav__button" id="btnNavMapa">üó∫Ô∏è Mapa</button>
        <button class="nav__button" id="btnLogin">Iniciar sesi√≥n</button>
        <button class="nav__button u-hidden" id="btnLogout">Cerrar sesi√≥n</button>
    </nav>

    <!-- Estado de sesi√≥n -->
    <div class="session-status u-hidden" id="sessionStatus"></div>
</header>

<!-- ============================================ -->
<!-- CONTENEDOR PRINCIPAL -->
<!-- ============================================ -->
<div class="main-container">

    <!-- ============================================ -->
    <!-- SECCI√ìN: LOGIN -->
    <!-- ============================================ -->
    <section class="section" id="loginSection">
        <h2>Iniciar Sesi√≥n</h2>
        <div class="u-text-muted u-mb-2" id="loginMessage"></div>

        <form id="formLogin" novalidate>
            <input
                    class="form__input"
                    type="text"
                    id="login_dni"
                    placeholder="DNI (7 a 10 d√≠gitos)"
                    pattern="[0-9]{7,10}"
                    inputmode="numeric"
                    maxlength="10"
                    required
            />
            <input
                    class="form__input"
                    type="email"
                    id="login_email"
                    placeholder="Email registrado"
                    required
            />
            <button class="button button--primary" type="submit" id="btnLoginSubmit">
                Iniciar Sesi√≥n
            </button>
        </form>

        <div class="form__message" id="loginResult"></div>

        <div class="divider">‚Äî o ‚Äî</div>

        <button type="button" class="button button--secondary" id="btnGoRegister">
            No tengo cuenta, quiero registrarme
        </button>
    </section>

    <!-- ============================================ -->
    <!-- SECCI√ìN: REGISTRAR AVISTADOR -->
    <!-- ============================================ -->
    <section class="section" id="avistadorSection">
        <h2>Crear mi cuenta (Avistador)</h2>
        <form id="formAvistador" novalidate>
            <div class="form__row">
                <input class="form__input" type="text" id="a_nombre" placeholder="Nombre" required />
                <input class="form__input" type="text" id="a_apellido" placeholder="Apellido" required />
            </div>
            <div class="form__row">
                <input class="form__input" type="text" id="a_dni" placeholder="DNI (7 a 10 d√≠gitos)" pattern="[0-9]{7,10}" inputmode="numeric" maxlength="10" required />
                <input class="form__input" type="number" id="a_edad" placeholder="Edad" min="0" required />
            </div>
            <input class="form__input" type="text" id="a_direccion" placeholder="Direcci√≥n" required />
            <div class="form__row">
                <input class="form__input" type="email" id="a_email" placeholder="Email (importante para login)" required />
                <input class="form__input" type="tel" id="a_telefono" placeholder="Tel√©fono (opcional)" />
            </div>
            <button class="button button--primary" type="submit" id="btnAvistador">
                Registrarme
            </button>
        </form>
        <div class="form__message" id="outAvistador"></div>
    </section>

    <!-- ============================================ -->
    <!-- SECCI√ìN: REGISTRAR DESAPARECIDO -->
    <!-- ============================================ -->
    <section class="section section--active" id="formSection">
        <h2>Registrar Persona Desaparecida</h2>
        <form id="formDesaparecido" novalidate>
            <div class="form__row">
                <input class="form__input" type="text" id="nombre" placeholder="Nombre" required />
                <input class="form__input" type="text" id="apellido" placeholder="Apellido" required />
            </div>
            <div class="form__row">
                <input class="form__input" type="number" id="edad" placeholder="Edad" min="0" required />
                <input class="form__input" type="text" id="dni" placeholder="DNI (7 a 10 d√≠gitos)" pattern="[0-9]{7,10}" inputmode="numeric" maxlength="10" required/>
            </div>
            <textarea class="form__textarea" id="descripcion" placeholder="Descripci√≥n" required></textarea>
            <input class="form__input" type="url" id="fotoUrl" placeholder="URL de la Foto (opcional)" />
            <button class="button button--primary" type="submit" id="btnSubmit">
                Enviar
            </button>
        </form>
        <div class="form__message" id="resultado"></div>
    </section>

    <!-- ============================================ -->
    <!-- SECCI√ìN: LISTA DE DESAPARECIDOS -->
    <!-- ============================================ -->
    <section class="section" id="listSection">
        <h2>Lista de Desaparecidos</h2>
        <button class="button button--secondary u-mb-2" id="btnReload">
            ‚Üª Recargar lista
        </button>
        <div class="u-text-muted" id="listaEstado"></div>
        <table class="table">
            <thead>
            <tr>
                <th class="table__header table__cell">Nombre</th>
                <th class="table__header table__cell">Apellido</th>
                <th class="table__header table__cell">DNI</th>
                <th class="table__header table__cell">Descripci√≥n</th>
                <th class="table__header table__cell">Foto</th>
                <th class="table__header table__cell">Fecha</th>
            </tr>
            </thead>
            <tbody id="tablaDesaparecidosBody"></tbody>
        </table>
    </section>

    <!-- ============================================ -->
    <!-- SECCI√ìN: MAPA DE AVISTAMIENTOS CON FILTROS -->
    <!-- ============================================ -->
    <section class="section" id="mapaSection">
        <h2>Mapa de Avistamientos</h2>

        <div class="map__controls">
            <button class="button button--secondary" id="btnReloadMapa">
                üîÑ Actualizar Mapa
            </button>
            <button class="button button--primary" id="btnToggleReportar">
                üìç Activar Modo Reportar
            </button>
        </div>

        <div class="map__status" id="mapaEstado"></div>

        <!-- Contenedor del mapa con sidebar -->
        <div class="mapa-container">
            <!-- Sidebar de Filtros -->
            <aside class="sidebar" id="sidebarFiltros">
                <!-- Header -->
                <div class="sidebar__header">
                    <h3 class="sidebar__title">Filtros</h3>
                    <button class="sidebar__toggle" id="btnToggleSidebar">√ó</button>
                </div>

                <div class="sidebar__content">
                    <!-- Contador de resultados -->
                    <div class="results-counter">
                        <span class="counter-number" id="counterNumber">0</span>
                        <span class="counter-label" id="counterLabel">avistamientos encontrados</span>
                    </div>

                    <!-- Lista de filtros -->
                    <div class="filtros-list">
                        <!-- Filtro: Todos -->
                        <div class="filtro-item filtro-item--active" id="filtroTodos">
                            <div class="filtro-header">
                                <div class="filtro-icon-title">
                                    <div class="filtro-icon">üó∫Ô∏è</div>
                                    <div class="filtro-content">
                                        <h4 class="filtro-title">Todos los avistamientos</h4>
                                        <p class="filtro-description">Ver todos en el mapa</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Filtro: Por Radio -->
                        <div class="filtro-item" id="filtroRadio">
                            <div class="filtro-header">
                                <div class="filtro-icon-title">
                                    <div class="filtro-icon">üìç</div>
                                    <div class="filtro-content">
                                        <h4 class="filtro-title">Buscar por radio</h4>
                                        <p class="filtro-description">Desde un punto espec√≠fico</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Controles del radio -->
                            <div class="filtro-controls u-hidden" id="radioControls">
                                <label class="radio-label">
                                    Radio: <span class="radio-value" id="radioValue">5 km</span>
                                </label>
                                <input type="range" class="radio-slider" id="radioSlider" min="1" max="50" value="5" />
                                <button class="btn-cambiar-punto" id="btnCambiarPuntoRadio">üìç Cambiar punto</button>
                            </div>
                        </div>

                        <!-- Filtro: Por √Årea -->
                        <div class="filtro-item" id="filtroArea">
                            <div class="filtro-header">
                                <div class="filtro-icon-title">
                                    <div class="filtro-icon">‚ñ¢</div>
                                    <div class="filtro-content">
                                        <h4 class="filtro-title">Buscar por √°rea</h4>
                                        <p class="filtro-description">Dibuja un rect√°ngulo</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Filtro: Por Pol√≠gono -->
                        <div class="filtro-item" id="filtroPoligono">
                            <div class="filtro-header">
                                <div class="filtro-icon-title">
                                    <div class="filtro-icon">‚¨°</div>
                                    <div class="filtro-content">
                                        <h4 class="filtro-title">Buscar por pol√≠gono</h4>
                                        <p class="filtro-description">√Årea personalizada</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Filtro: Por Desaparecido -->
                        <div class="filtro-item" id="filtroDesaparecido">
                            <div class="filtro-header">
                                <div class="filtro-icon-title">
                                    <div class="filtro-icon">üë§</div>
                                    <div class="filtro-content">
                                        <h4 class="filtro-title">Por persona</h4>
                                        <p class="filtro-description">Filtrar por desaparecido</p>
                                    </div>
                                </div>
                            </div>
                            <div class="filtro-controls">
                                <select class="desaparecido-select" id="filtroDesaparecidoSelect">
                                    <option value="">Selecciona una persona</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Bot√≥n Reset -->
                    <button class="btn-reset u-hidden" id="btnResetFiltros">üîÑ Limpiar filtros</button>
                </div>
            </aside>

            <!-- Mapa -->
            <div class="map-wrapper">
                <div class="map" id="map"></div>
            </div>
        </div>
    </section>

</div> <!-- fin main-container -->

<!-- ============================================ -->
<!-- MODAL: REPORTAR AVISTAMIENTO -->
<!-- ============================================ -->
<div class="modal u-hidden" id="modalAvistamiento">
    <div class="modal__content">
        <div class="modal__header">
            <h3 class="modal__title">üìç Reportar Avistamiento</h3>
            <button class="modal__close" id="btnCloseModal">&times;</button>
        </div>

        <div class="modal__body">
            <div class="modal__coords" id="modalCoords">
                üìç Ubicaci√≥n: <span id="modalLatLng"></span>
            </div>

            <form id="formAvistamiento" novalidate>
                <label class="form__label">
                    <span class="form__label-text">Persona desaparecida *</span>
                    <select class="form__input" id="av_desaparecido" required>
                        <option value="">-- Seleccionar --</option>
                    </select>
                </label>

                <label class="form__label">
                    <span class="form__label-text">Descripci√≥n del avistamiento *</span>
                    <textarea
                            class="form__textarea"
                            id="av_descripcion"
                            placeholder="Ej: Vi a esta persona cerca del parque..."
                            minlength="20"
                            required
                    ></textarea>
                    <small class="form__hint">M√≠nimo 20 caracteres</small>
                </label>

                <label class="form__label">
                    <span class="form__label-text">Foto (URL, opcional)</span>
                    <input class="form__input" type="url" id="av_foto" placeholder="https://..." />
                </label>

                <label class="form__label form__label--checkbox">
                    <input type="checkbox" id="av_publico" checked />
                    <span>Hacer p√∫blico este avistamiento</span>
                </label>

                <button class="button button--primary" type="submit" id="btnSubmitAvistamiento">
                    Enviar Avistamiento
                </button>
            </form>

            <div class="form__message" id="avistamientoResult"></div>
        </div>
    </div>
</div>

<!-- ‚ú® Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

<!-- Tu script -->
<script type="module" src="js/app.js"></script>

</body>
</html>